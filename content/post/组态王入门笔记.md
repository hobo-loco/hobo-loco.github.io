---
title: "组态王入门笔记"
date: 2024-03-26T22:27:23+08:00
#lead:    # 导言
description: ""
tags:
    - 组态王
    - SCADA
categories:
    - NTECHNOLOGY
---

组态王如何新建工程，以及与下位机连接。

<!--more-->

## 组态王入门
### 创建组态王工程
首先为工程指定**工作目录**（即工程路径），组态王用工作目录标识工程，每个工程必须建立在单独的目录中。工作目录下的文件由组态王自动管理。

    1. 菜单栏"文件/新建工程"或直接单击"新建"
    2. 菜单栏"工具/切换到开发系统"

### 定义I/O设备

只有定义了外部设备，组态王才能通过I/O变量和它们交换数据。下面以PLC与组态王连接为例。

> 安装完组态王后，还须安装组态王驱动

#### PLC通过串口连接组态王

    * 组态王为主站，PLC为从站；

    * PLC从站地址1、波特率19200、数据位8位、停止位1位、偶校验、通讯物理线路RS485

  > 上述设置根据实际PLC进行确定。
  
选择**工程浏览器**左侧`设备/COM1`，双击右侧`新建`，运行设备配置向导：

1. 设备配置向导中选择对应PLC的通讯协议，如`莫迪康/ModbusRTU/COM`
    1. 给PLC命名，以便识别
    2. 选择串口号，如`COM5`（与电脑连线的串口号相同）
    3. 设置PLC从站地址，如`1`（如需自定义，需要在PLC中更改）
    4. 通信参数，默认

2. 左侧`设备/COM5`设置串口参数（COM5）
    1. 波特率：19200
    2. 奇偶校验：偶校验
    3. 数据位：8
    4. 停止位：1
    5. 通信方式：RS485

完成上述操作后，在**工程浏览器**右侧可看到新建的PLC名称。定义数据变量时，只要把I/O变量连接到这台设备上，两者就可交换数据了。

单击工具栏中'VIEW'按钮，切换到运行状态。如报错，则根据提示信息解决。

#### PLC通过网口连接组态王

    * 组态王为服务器端（从），电脑IP地址：192.168.1.99

    * PLC为客户端（主），PLC的IP地址：192.168.1.110

    * 通讯物理线路为普通网线

  > 本例为PLC标配网口，内置`Modbus-TCP`客户端（主）/服务器（从）协议

---
 设备配置向导中选择相应的通讯协议，如`莫迪康/ModbusTCP/TCP`

1. 给PLC命名，以便区分

2. 任选一个COM口，**不能与电脑设备管理器中的端口一样**
    > 注2：组态王中，网络设备需要选择串口的原因：一个设备接口（如COM1、网卡）开启一个线程

3. 填写PLC的IP地址、端口，如：'192.168.1.110	1'
    ```
        * IP         PLC的IP地址
        * Port       Modbus协议对应的端口，默认502
        * Address    Modbus的PLC从站地址，范围1-255
        * TimeOut    网络超时（不写默认30秒）
        * '[ ]'      '[ ]'内不写采用驱动默认值，写则采用用户自定义值
    ```

> 本例中只填了PLC的IP地址192.168.1.110，和站地址1，其它不填采用默认值

4. 通信参数，默认
---
### 数据库建点
数据库是连接上位机和下位机的桥梁。数据库中变量的集合，形象的成为**数据词典**，数据词典记录了所有用户可使用的数据变量的详细信息。

组态王变量地址连接到PLC变量地址。

组态王中变量的偏移地址，都是以1为起始地址的。注意PLC中变量的地址便宜。

#### 新建变量并连接到PLC的地址

1. **工程浏览器**左侧`数据库/数据词典/新建`，弹出**变量属性**对话框

2. 定义变量
   1. 变量名：用户定义的名称
   2. **变量类型**：有内存和I/O两大类，内存是指组态软件内部的变量，跟PLC无关；I/O类是跟PLC相关的

      ```
      I/O离散：   对应PLC的开关量，即0和1开头的变量
      I/O整型：   对应PLC的模拟量，即3和4开头的变量，不带小数点的整数
      I/O实数：   对应PLC的模拟量，即3和4开头的变量，带小数点的浮点数
      I/O字符串： 用于记录一些有特定含义的字符串，如名称、密码
      ```

   3. 变量灵敏度：数据类型为整型或实数时此项才有效。只有当该数据变量的值，变化幅度超过`变量灵敏度`时，**组态王**才更新与之相连接的画面显示（缺省为0）

   4. 最小值/最大值：指该变量在组态王显示的下限/上限

   5. 最小原始值/最大原始值：组态王从PLC读取的原始模拟值的下限/上限

   6. 保存参数：系统运行时，若变量的类型发生了变化，组态王退出时，系统自动保存该类型，下次启动后，变量的初始类型为上次保存的类型

   7. 保存数值：系统运行时，若变量的值发生了变化，组态王退出时，系统自动保存该值，下次启动后，变量的初始值恢复为上次系统退出时保存的值。

   8. **初始值**：组态王开始运行时的初始值，一般为**关**

   9. **连接设备**：哪个PLC的变量

   10. **寄存器**：连接PLC的哪个变量，填写对应的PLC变量地址（某些PLC可能需转换）

   11. 采集频率：当采集频率为0时，只要组态王上的值发生变化，就会进行写PLC操作；当采集频率不为0时，按照采集频率，周期性的输出值到PLC

   12. 转换方式：通过什么方式把PLC的模拟量输入值转换为组态王数据库值，一般是**线性**

   13. **数据类型**：定义PLC变量的寄存器的数据类型，共9中，如下:

       ```
       BIT:     1位，（0或1）
       BYTE:    8位，1个字节，（0~255）
       SHORT:   16位，2字节，（-32768~32767）
       USHORT:  16位，2字节，（0~65535）
       BCD:     16位，2字节，（0~9999）
       LONG:    32位，4字节，（-2147483648~2147483647）
       LONGBCD: 32位，4字节，（0~4294967295）
       FLOAT:   32位，4字节，（-3.40E+38~+3.40E+38，有效位7位）
       STEING:  128个字符长度
       ```
    14. **读写属性**：只读/只写/读写

### 创建组态画面
#### 新建画面
**工程浏览器**左侧`文件/画面`，双击右侧的`新建`图标，弹出画面属性对话框：

1. 画面属性

   1. **画面名称**：

   1. 对应文件：

   1. 画面位置：

   1. 画面风格：

   1. 命令语言：

2. 开发系统
    
    绘制画面

3. 创建图形对象

    从`工具箱`中选择图形进行绘制

### 建立动画连接

组态王提供了24种动画连接方式：

 
    属性变化----------线、填充、文本色变化
    位置与大小变化----填充、缩放、旋转、水平移动、垂直移动
    值输出------------模拟值、离散值、字符串输出
    值输入------------模拟值、离散值、字符串输入
    特殊--------------闪烁、隐含、流动（仅适用于立体管道）
    滑动杆输入--------水平、垂直
    命令语言----------按下时、弹起时、安装时、鼠标进入、鼠标离开

>一个图形可同时定义多个连接。

### 运行和调试

在开发系统中，选择`文件/切换到View`，进入组态王运行系统。

在运行系统中，选择`画面/打开`，选择创建的画面。